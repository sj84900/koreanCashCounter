
## 개요
이 프로그램은 **FastAPI**와 **YOLOv11**을 활용하여 이미지에서 화폐를 감지하고 총 금액을 계산하는 웹 애플리케이션입니다. 사용자는 사진을 업로드하면 YOLO 모델이 화폐를 인식하고, 각 화폐의 개수와 총 금액을 계산하여 결과를 제공합니다.

---

## 주요 기능
1. **이미지 업로드 및 처리**  
   - 사용자가 웹 페이지에서 이미지를 업로드하면 서버에서 이를 저장하고 YOLO 모델을 통해 분석합니다.
   - 감지된 화폐의 종류와 개수를 계산하여 총 금액을 출력합니다.

2. **YOLO 모델을 활용한 화폐 감지**  
   - YOLOv11 모델을 사용하여 이미지 내 화폐를 감지합니다.
   - 감지된 화폐의 신뢰도가 설정된 임계값(threshold) 이상일 경우 개수를 계산합니다.

3. **결과 시각화**  
   - 감지된 화폐 정보를 웹 페이지에서 표 형태로 출력합니다.
   - 분석된 이미지(감지된 화폐가 표시된 이미지)를 사용자에게 제공합니다.

---

## 설치 및 실행 방법

### 1. 필수 라이브러리 설치
```bash
pip install fastapi uvicorn jinja2 opencv-python ultralytics
```

### 2. 프로젝트 폴더 구조
```
project_root/
│── main.py          # FastAPI 서버 실행 파일
│── train.py         # YOLO 모델 학습 파일
│── predict.py       # YOLO 모델 예측 파일
│── templates/
│   └── index.html   # 웹 페이지 템플릿
│── runs/            # YOLO 결과 저장 폴더
│── usingModel/      # YOLO 모델 저장 폴더
│── data.yaml        # YOLO 학습 데이터 설정 파일
```

## 서버 실행

### 1. 로컬 실행  
- `uvicorn main:app --reload` 명령어를 사용하여 **포트 8000**에서 실행  
- `http://127.0.0.1:8000/` 에 접속하여 웹 페이지 확인  

### 2. AWS 서버에서 실행  
- `uvicorn main:app --host 0.0.0.0 --port 8000` 명령어를 사용하여 **외부 접근 가능**하도록 설정  
- AWS 보안 그룹에서 **포트 80**과 **포트 8000** 개방 필요  
- `nohup`을 사용하여 **백그라운드 실행** 가능  

### 3. Nginx를 이용한 80포트 설정  
- **Nginx 설치** 후 설정 파일 수정하여 **포트 80**에서 FastAPI 접근 가능하도록 설정  
- `proxy_pass`를 사용하여 **8000번 포트의 FastAPI 서버를 80번 포트로 프록시**  
- Nginx 재시작 후 AWS 퍼블릭 IP로 접속하면 **포트 80에서 웹 애플리케이션 사용 가능**  


## 코드 설명

### 1. `main.py` (FastAPI 서버)
FastAPI를 사용하여 웹 애플리케이션을 구현합니다.

#### 주요 기능:
- `/` : 웹 페이지 렌더링 (`index.html`)
- `/upload` : 이미지 업로드 및 YOLO 모델을 통한 화폐 감지

#### YOLO 모델을 활용한 화폐 감지 과정:
1. 사용자가 이미지를 업로드하면 `runs/detect/latest` 폴더에 저장됩니다.
2. YOLO 모델(`usingModel/last.pt`)을 사용하여 이미지에서 화폐를 감지합니다.
3. 감지된 화폐의 개수를 계산하고 총 금액을 산출합니다.
4. 결과를 웹 페이지에 출력합니다.

---

### 2. `train.py` (YOLO 모델 학습)
YOLO 모델을 학습시키는 코드입니다.

#### 주요 기능:
- GPU 사용 가능 여부 확인
- YOLO 모델 학습 (`epochs=50`, `batch=16`, `imgsz=640`)
- 학습된 모델을 `onnx` 형식으로 내보내기

#### 실행 방법:
```bash
python train.py
```
- 학습이 완료되면 `runs/detect/train/weights/last.pt`에 모델이 저장됩니다.

---

### 3. `predict.py` (YOLO 모델 예측)
YOLO 모델을 사용하여 특정 이미지에서 화폐를 감지하는 코드입니다.

#### 주요 기능:
- YOLO 모델(`runs/detect/train/weights/last.pt`)을 로드하여 이미지 분석
- 감지된 화폐의 클래스 ID와 신뢰도 출력
- 결과 이미지 저장

#### 실행 방법:
```bash
python predict.py
```
- `test/images/test01.jpg`을 분석하여 결과를 출력합니다.

---

## 웹 페이지 (`index.html`)
사용자가 이미지를 업로드하고 결과를 확인할 수 있는 웹 페이지입니다.

#### 주요 기능:
- 파일 업로드 폼 제공
- YOLO 분석 결과(총 금액 및 화폐 개수) 출력
- 감지된 화폐가 표시된 이미지 제공

---

## 활용 예시
1. 사용자가 스마트폰으로 지폐 및 동전 사진을 촬영하여 업로드
2. YOLO 모델이 화폐를 감지하고 개수를 계산
3. 웹 페이지에서 총 금액과 각 화폐의 개수를 확인

---

## 개선 가능 사항
- 더 많은 화폐 종류를 학습하여 인식 정확도 향상
- 모바일 친화적인 UI 개선
- 실시간 카메라 입력을 통한 화폐 감지 기능 추가

---
